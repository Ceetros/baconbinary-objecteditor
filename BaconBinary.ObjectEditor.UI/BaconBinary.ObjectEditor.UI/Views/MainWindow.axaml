<Window xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:vm="using:BaconBinary.ObjectEditor.UI.ViewModels"
        xmlns:cv="using:BaconBinary.ObjectEditor.UI.Converters"
        xmlns:models="using:BaconBinary.Core.Models"
        x:Class="BaconBinary.ObjectEditor.UI.Views.MainWindow"
        x:Name="RootWindow"
        x:DataType="vm:MainViewModel"
        Title="BaconBinary Suite"
        Icon="/Assets/avalonia-logo.ico"
        WindowState="Maximized"
        Background="{DynamicResource AppBackgroundBrush}"
        Foreground="{DynamicResource TextPrimaryBrush}">

    <Window.DataContext>
        <vm:MainViewModel/>
    </Window.DataContext>

    <Window.Resources>
        <cv:ThingToBitmapConverter x:Key="ThingToBitmapConverter"/>
    </Window.Resources>

    <Grid RowDefinitions="Auto, *">
        
        <Border Grid.Row="0" Background="{DynamicResource PanelBackgroundBrush}" BorderBrush="{DynamicResource BorderBrush}" BorderThickness="0,0,0,1" Padding="10,5">
            <Grid ColumnDefinitions="Auto, *, Auto">
                <StackPanel Grid.Column="0" Orientation="Horizontal" Spacing="5">
                    <Button Command="{Binding OpenFilesCommand}" CommandParameter="{Binding ElementName=RootWindow}" 
                            Background="Transparent" BorderThickness="0" ToolTip.Tip="Open Project">
                        <StackPanel Orientation="Horizontal" Spacing="5">
                            <TextBlock Text="ðŸ“‚" VerticalAlignment="Center"/>
                            <TextBlock Text="Open" VerticalAlignment="Center" FontWeight="SemiBold"/>
                        </StackPanel>
                    </Button>
                    <Button Background="Transparent" BorderThickness="0" ToolTip.Tip="Save Project">
                        <StackPanel Orientation="Horizontal" Spacing="5">
                            <TextBlock Text="ðŸ’¾" VerticalAlignment="Center"/>
                            <TextBlock Text="Save" VerticalAlignment="Center"/>
                        </StackPanel>
                    </Button>
                </StackPanel>

                <Border Grid.Column="2" Background="{DynamicResource AccentBrush}" CornerRadius="12" Padding="10,2" VerticalAlignment="Center">
                    <TextBlock Text="{Binding VersionString}" Foreground="White" FontWeight="Bold" FontSize="11" VerticalAlignment="Center"/>
                </Border>
            </Grid>
        </Border>

        <Grid Grid.Row="1" ColumnDefinitions="260, 4, *, 4, 260" Margin="5">

            <Grid Grid.Column="0" RowDefinitions="Auto, *, Auto">
                
                <Border Grid.Row="0" Classes="Panel" Height="200" Margin="0,0,0,5">
                    <Grid RowDefinitions="Auto, *">
                        <TextBlock Text="PREVIEW" Classes="PanelTitle"/>
                        <Border Grid.Row="1" Margin="10" CornerRadius="4" ClipToBounds="True" Background="{DynamicResource CheckerboardBrush}">
                            <Image Source="{Binding SelectedItem, Converter={StaticResource ThingToBitmapConverter}}" 
                                   Stretch="None" 
                                   HorizontalAlignment="Center" 
                                   VerticalAlignment="Center"/>
                        </Border>
                        <TextBlock Grid.Row="1" Text="{Binding SelectedItem.ID, StringFormat='ID: {0}'}" 
                                   VerticalAlignment="Bottom" HorizontalAlignment="Right" 
                                   Margin="5" Background="#80000000" Padding="4,2" FontSize="10" Foreground="White"/>
                    </Grid>
                </Border>

                <Border Grid.Row="1" Classes="Panel">
                    <Grid RowDefinitions="Auto, *">
                        <TextBlock Text="PROPERTIES" Classes="PanelTitle"/>
                        <ScrollViewer Grid.Row="1" Padding="10,0,10,10">
                            <StackPanel Spacing="2">
                                <TextBlock Text="General" FontWeight="Bold" Margin="0,5" Foreground="{DynamicResource AccentBrush}"/>
                                
                                <Grid ColumnDefinitions="*, *" RowDefinitions="Auto, Auto, Auto, Auto">
                                    <CheckBox Grid.Row="0" Grid.Column="0" Content="Ground" IsChecked="{Binding SelectedItem.IsGround, FallbackValue=False}" IsEnabled="False"/>
                                    <CheckBox Grid.Row="0" Grid.Column="1" Content="Container" IsChecked="{Binding SelectedItem.IsContainer, FallbackValue=False}" IsEnabled="False"/>
                                    
                                    <CheckBox Grid.Row="1" Grid.Column="0" Content="Stackable" IsChecked="{Binding SelectedItem.IsStackable, FallbackValue=False}" IsEnabled="False"/>
                                    <CheckBox Grid.Row="1" Grid.Column="1" Content="Force Use" IsChecked="{Binding SelectedItem.ForceUse, FallbackValue=False}" IsEnabled="False"/>
                                    
                                    <CheckBox Grid.Row="2" Grid.Column="0" Content="Writable" IsChecked="{Binding SelectedItem.IsWritable, FallbackValue=False}" IsEnabled="False"/>
                                    <CheckBox Grid.Row="2" Grid.Column="1" Content="Fluid" IsChecked="{Binding SelectedItem.IsFluid, FallbackValue=False}" IsEnabled="False"/>
                                </Grid>

                                <Separator Background="{DynamicResource BorderBrush}" Height="1" Margin="0,10"/>
                                
                                <TextBlock Text="Collision" FontWeight="Bold" Margin="0,5" Foreground="{DynamicResource AccentBrush}"/>
                                <CheckBox Content="Block Solid" IsChecked="{Binding SelectedItem.IsUnpassable, FallbackValue=False}" IsEnabled="False"/>
                                <CheckBox Content="Block Projectile" IsChecked="{Binding SelectedItem.BlockMissile, FallbackValue=False}" IsEnabled="False"/>
                                <CheckBox Content="Block Pathfind" IsChecked="{Binding SelectedItem.BlockPathfind, FallbackValue=False}" IsEnabled="False"/>

                                <Separator Background="{DynamicResource BorderBrush}" Height="1" Margin="0,10"/>
                                
                                <TextBlock Text="Visual" FontWeight="Bold" Margin="0,5" Foreground="{DynamicResource AccentBrush}"/>
                                <CheckBox Content="Always Animate" IsChecked="{Binding SelectedItem.AnimateAlways, FallbackValue=False}" IsEnabled="False"/>
                                <CheckBox Content="Lying Object" IsChecked="{Binding SelectedItem.IsLyingObject, FallbackValue=False}" IsEnabled="False"/>
                                <CheckBox Content="Top Effect" IsChecked="{Binding SelectedItem.IsTopEffect, FallbackValue=False}" IsEnabled="False"/>
                            </StackPanel>
                        </ScrollViewer>
                    </Grid>
                </Border>

                <Border Grid.Row="2" Classes="Panel" Margin="0,5,0,0">
                    <Grid RowDefinitions="Auto, *">
                        <TextBlock Text="STATISTICS" Classes="PanelTitle"/>
                        <UniformGrid Columns="2" Margin="10,0,10,10">
                            <TextBlock Text="Items:" Foreground="{DynamicResource TextSecondaryBrush}"/>
                            <TextBlock Text="{Binding ItemCount}" FontWeight="Bold" HorizontalAlignment="Right"/>
                            
                            <TextBlock Text="Outfits:" Foreground="{DynamicResource TextSecondaryBrush}"/>
                            <TextBlock Text="{Binding OutfitCount}" FontWeight="Bold" HorizontalAlignment="Right"/>
                            
                            <TextBlock Text="Sprites:" Foreground="{DynamicResource TextSecondaryBrush}"/>
                            <TextBlock Text="{Binding SpriteCount}" FontWeight="Bold" HorizontalAlignment="Right"/>
                        </UniformGrid>
                    </Grid>
                </Border>
            </Grid>

            <GridSplitter Grid.Column="1" Background="Transparent" ResizeBehavior="PreviousAndNext"/>

            <Border Grid.Column="2" Classes="Panel">
                <Grid RowDefinitions="Auto, *">
                    <Grid Grid.Row="0" ColumnDefinitions="Auto, *, Auto" Margin="10">
                        <ComboBox Grid.Column="0" 
                                  SelectedIndex="{Binding SelectedCategoryIndex}" 
                                  Margin="0,0,5,0" Width="100">
                            <ComboBoxItem>Items</ComboBoxItem>
                            <ComboBoxItem>Outfits</ComboBoxItem>
                            <ComboBoxItem>Effects</ComboBoxItem>
                            <ComboBoxItem>Missiles</ComboBoxItem>
                        </ComboBox>
                        
                        <TextBox Grid.Column="1" Watermark="Search by ID or Name..." CornerRadius="4"/>
                        
                        <Button Grid.Column="2" Content="Filter" Margin="5,0,0,0"/>
                    </Grid>
                    
                    <Separator Grid.Row="0" VerticalAlignment="Bottom" Background="{DynamicResource BorderBrush}" Height="1"/>

                    <ListBox Grid.Row="1" 
                             ItemsSource="{Binding Items}" 
                             SelectedItem="{Binding SelectedItem}"
                             Background="Transparent"
                             BorderThickness="0"
                             Padding="5"
                             ScrollViewer.HorizontalScrollBarVisibility="Disabled">
                        
                        <ListBox.ItemsPanel>
                            <ItemsPanelTemplate>
                                <WrapPanel ItemWidth="42" ItemHeight="42" />
                            </ItemsPanelTemplate>
                        </ListBox.ItemsPanel>

                        <ListBox.ItemTemplate>
                            <DataTemplate x:DataType="models:ThingType">
                                <Border Background="{DynamicResource PanelBackgroundBrush}" 
                                        BorderBrush="{DynamicResource BorderBrush}" 
                                        BorderThickness="1" 
                                        CornerRadius="4"
                                        ToolTip.Tip="{Binding ID, StringFormat='ID: {0}'}">
                                    <Image Source="{Binding ., Converter={StaticResource ThingToBitmapConverter}}" 
                                           Stretch="None" 
                                           HorizontalAlignment="Center" 
                                           VerticalAlignment="Center"/>
                                </Border>
                            </DataTemplate>
                        </ListBox.ItemTemplate>
                    </ListBox>
                    
                    <Grid Grid.Row="1" Background="#80000000" IsVisible="{Binding IsLoading, FallbackValue=False}">
                         <TextBlock Text="Loading..." HorizontalAlignment="Center" VerticalAlignment="Center" Foreground="White"/>
                    </Grid>
                </Grid>
            </Border>

            <GridSplitter Grid.Column="3" Background="Transparent" ResizeBehavior="PreviousAndNext"/>

            <Grid Grid.Column="4" RowDefinitions="*, *">
                 <Border Grid.Row="0" Classes="Panel" Margin="0,2,2,2">
                     <Grid RowDefinitions="Auto, *">
                         <TextBlock Text="SPRITES" Classes="PanelTitle"/>
                         <TextBlock Text="Coming Soon..." HorizontalAlignment="Center" VerticalAlignment="Center" Foreground="#555"/>
                     </Grid>
                 </Border>
                 
                 <Border Grid.Row="1" Classes="Panel" Margin="0,2,2,2">
                     <Grid RowDefinitions="Auto, *">
                         <TextBlock Text="RAW DATA" Classes="PanelTitle"/>
                         <TextBlock Text="Hex View" HorizontalAlignment="Center" VerticalAlignment="Center" Foreground="#555"/>
                     </Grid>
                 </Border>
            </Grid>

        </Grid>
        
        <Border Grid.Row="1" VerticalAlignment="Bottom" HorizontalAlignment="Left" 
                Background="{DynamicResource AccentBrush}" 
                CornerRadius="0,4,0,0" Padding="10,5" Margin="0,0,0,0"
                IsVisible="{Binding StatusText, Converter={x:Static StringConverters.IsNotNullOrEmpty}}">
            <TextBlock Text="{Binding StatusText}" Foreground="White" FontSize="11" FontWeight="SemiBold"/>
        </Border>

    </Grid>
</Window>